<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueSky Personality Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-switch button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .lang-switch button:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="glass-card">
            <div class="lang-switch">
                <button onclick="switchLanguage('cn')" title="ä¸­æ–‡">ğŸ‡¨ğŸ‡³</button>
                <button onclick="switchLanguage('jp')" title="æ—¥æœ¬èª">ğŸ‡¯ğŸ‡µ</button>
                <button onclick="switchLanguage('en')" title="English">ğŸ‡ºğŸ‡¸</button>
            </div>
            <h1 class="title" id="titleText">BlueSky äººæ ¼åˆ†æå™¨</h1>
            <p class="subtitle" id="subtitleText">è¾“å…¥æ‚¨çš„ Handleï¼ŒAI å°†ä¸ºæ‚¨æ­ç¤º MBTI ä¸çµé­‚åŠ¨ç‰©</p>

            <div class="input-group">
                <input type="text" id="handleInput" placeholder="ä¾‹å¦‚: jay.bsky.social" value="jay.bsky.social">
                <button id="analyzeBtn" onclick="analyzeProfile()"><span id="btnText">å¼€å§‹åˆ†æ</span></button>
            </div>

            <div id="loader" class="loader">
                <div class="spinner"></div>
                <p id="loadingText">æ­£åœ¨è¿æ¥ç¥ç»å…ƒ...å¯èƒ½éœ€è¦ 10-20 ç§’</p>
            </div>

            <div id="result-section">
                <div class="profile-header">
                    <img id="avatar" src="" alt="Avatar" class="avatar">
                    <div class="profile-name">
                        <h3 id="displayName">Display Name</h3>
                        <span id="handle">@handle</span>
                    </div>
                </div>

                <div class="result-cards">
                    <div class="info-card">
                        <div class="card-label" id="mbtiLabel">MBTI ç±»å‹</div>
                        <div class="card-value" id="mbtiValue">INTJ</div>
                    </div>
                    <div class="info-card">
                        <div class="card-label" id="animalLabel">çµé­‚åŠ¨ç‰©</div>
                        <div class="card-value" id="animalValue">é»‘è±¹</div>
                    </div>
                </div>

                <div class="analysis-text">
                    <div class="card-label" id="descLabel" style="text-align: left; margin-bottom: 1rem;">æ€§æ ¼ç”»åƒ</div>
                    <p id="descriptionText">
                        AI ç”Ÿæˆçš„è¯¦ç»†æè¿°å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLang = 'cn';

        const translations = {
            cn: {
                title: "BlueSky äººæ ¼åˆ†æå™¨",
                subtitle: "è¾“å…¥æ‚¨çš„ Handleï¼ŒAI å°†ä¸ºæ‚¨æ­ç¤º MBTI ä¸çµé­‚åŠ¨ç‰©",
                btn: "å¼€å§‹åˆ†æ",
                loading: "æ­£åœ¨è¿æ¥ç¥ç»å…ƒ...å¯èƒ½éœ€è¦ 10-20 ç§’",
                mbti: "MBTI ç±»å‹",
                animal: "çµé­‚åŠ¨ç‰©",
                desc: "æ€§æ ¼ç”»åƒ",
                alertInput: "è¯·è¾“å…¥æœ‰æ•ˆçš„ BlueSky Handleï¼",
                alertError: "å‘ç”Ÿé”™è¯¯: "
            },
            jp: {
                title: "BlueSky æ€§æ ¼è¨ºæ–­",
                subtitle: "Handleã‚’å…¥åŠ›ã—ã¦ã€AIãŒMBTIã¨å‹•ç‰©å ã„ã‚’æ˜ã‚‰ã‹ã«ã—ã¾ã™",
                btn: "è¨ºæ–­é–‹å§‹",
                loading: "ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³æ¥ç¶šä¸­... 10-20ç§’ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™",
                mbti: "MBTI ã‚¿ã‚¤ãƒ—",
                animal: "å‹•ç‰©å ã„",
                desc: "æ€§æ ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«",
                alertInput: "æœ‰åŠ¹ãªBlueSky Handleã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼",
                alertError: "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: "
            },
            en: {
                title: "BlueSky Personality Analyzer",
                subtitle: "Enter your Handle, AI will reveal your MBTI & Spirit Animal",
                btn: "Analyze",
                loading: "Connecting neurons... may take 10-20 seconds",
                mbti: "MBTI Type",
                animal: "Spirit Animal",
                desc: "Portrait",
                alertInput: "Please enter a valid BlueSky Handle!",
                alertError: "Error occurred: "
            }
        };

        function switchLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            document.getElementById('titleText').textContent = t.title;
            document.getElementById('subtitleText').textContent = t.subtitle;
            document.getElementById('btnText').textContent = t.btn;
            document.getElementById('loadingText').textContent = t.loading;
            document.getElementById('mbtiLabel').textContent = t.mbti;
            document.getElementById('animalLabel').textContent = t.animal;
            document.getElementById('descLabel').textContent = t.desc;
        }

        async function analyzeProfile() {
            const handleInput = document.getElementById('handleInput');
            const handle = handleInput.value.trim();
            const btn = document.getElementById('analyzeBtn');
            const loader = document.getElementById('loader');
            const resultSection = document.getElementById('result-section');

            if (!handle) {
                alert(translations[currentLang].alertInput);
                return;
            }

            // UI State: Loading
            btn.disabled = true;
            loader.style.display = 'block';
            resultSection.style.display = 'none';

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ handle: handle, lang: currentLang })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || "è¯·æ±‚å¤±è´¥");
                }

                // Render Results
                document.getElementById('mbtiValue').textContent = data.analysis.mbti;
                document.getElementById('animalValue').textContent = data.analysis.animal;
                document.getElementById('descriptionText').textContent = data.analysis.description;

                // Profile Data
                const profile = data.profile;
                if (profile) {
                    document.getElementById('displayName').textContent = profile.displayName || handle;
                    document.getElementById('handle').textContent = `@${profile.handle}`;
                    if (profile.avatar) {
                        document.getElementById('avatar').src = profile.avatar;
                    } else {
                        // Default placeholder
                        document.getElementById('avatar').src = "https://ui-avatars.com/api/?name=" + profile.handle;
                    }
                }

                resultSection.style.display = 'block';

            } catch (error) {
                alert(translations[currentLang].alertError + error.message);
                console.error(error);
            } finally {
                btn.disabled = false;
                loader.style.display = 'none';
            }
        }
    </script>
</body>

</html>